services:
  mangobyte:
    build: .
    container_name: mangobyte
    restart: unless-stopped
    volumes:
      - ./data/botdata.json:/app/botdata.json
      - ./data/settings.json:/app/settings.json
    environment:
      - TZ=UTC

  backup:
    image: alpine:latest
    container_name: mangobyte-backup
    restart: unless-stopped
    volumes:
      - ./data:/data:ro
      - ./backups:/backups
    entrypoint: /bin/sh
    command: >
      -c "echo 'Backup service started. Running every 12 hours.';
        while true; do
          sleep 43200;
          TIMESTAMP=$$(date +%Y%m%d_%H%M%S);
          cp /data/botdata.json /backups/botdata_$$TIMESTAMP.json 2>/dev/null && echo \"Backed up botdata at $$TIMESTAMP\";
          cp /data/settings.json /backups/settings_$$TIMESTAMP.json 2>/dev/null && echo \"Backed up settings at $$TIMESTAMP\";
          ls -t /backups/botdata_*.json 2>/dev/null | tail -n +11 | xargs rm -f 2>/dev/null;
          ls -t /backups/settings_*.json 2>/dev/null | tail -n +11 | xargs rm -f 2>/dev/null;
        done"
